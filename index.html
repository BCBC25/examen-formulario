¬¥¬¥
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>University Examination Portal</title>

<style>
body {
  font-family: "Segoe UI", Roboto, Arial, sans-serif;
  background: #eef2f7;
}
.container {
  max-width: 900px;
  margin: auto;
  padding: 40px 20px;
}
.card {
  background: #fff;
  padding: 30px;
  border-radius: 10px;
}
.question { margin-bottom: 26px; }
.option-row { display: flex; gap: 8px; margin: 6px 0; }
.calc-wrapper {
  display: flex;
  gap: 12px;
  margin-top: 6px;
}
.calc-value { flex: 2; }
.calc-unit { flex: 1; }
button {
  background: #2563eb;
  color: white;
  border: none;
  padding: 10px;
  border-radius: 6px;
  cursor: pointer;
}
.submit-btn {
  width: 100%;
  font-size: 16px;
}
</style>
</head>

<body>

<div class="container">
  <div class="card">
    <h1>DRILLING TEST</h1>

    <form id="examForm">
      <label>Name</label>
      <input type="text" name="nombre" required>

      <label>Email</label>
      <input type="email" name="email" required>

      <input type="hidden" name="testId" value="1">

      <div id="preguntas"></div>

      <button type="submit" class="submit-btn">Submit Exam</button>
    </form>

    <div id="resultado"></div>
  </div>
</div>

<script>
const USE_TEST = true;

const SUBMIT_URL = USE_TEST
  ? "https://gilloli.app.n8n.cloud/webhook-test/student-exam-submission-v2"
  : "https://gilloli.app.n8n.cloud/webhook/student-exam-submission-v2";

const questionsUrl =
"https://script.google.com/macros/s/AKfycbwOJdDrp_XNfIQPv6mph0IhzI7W9JGZFhqErWC5YJE-UfkETADJNkB0IfYJCiEp4_pxcg/exec";

const form = document.getElementById("examForm");
const resultadoDiv = document.getElementById("resultado");

/* ========= LOAD QUESTIONS ========= */
fetch(questionsUrl)
.then(res => res.json())
.then(preguntas => {
  const container = document.getElementById("preguntas");
  container.innerHTML = "";

  preguntas.forEach(p => {
    let html = `<div class="question"><strong>${p.id}. ${p.pregunta}</strong>`;

    if (p.tipo === "multiple option") {
      ["A","B","C","D"].forEach(o => {
        html += `
        <label class="option-row">
          <input type="radio" name="q${p.id}" value="${o}">
          ${o}) ${p["opcion"+o]}
        </label>`;
      });
    }

    if (p.tipo === "true/false") {
      html += `
      <label class="option-row">
        <input type="radio" name="q${p.id}" value="true"> True
      </label>
      <label class="option-row">
        <input type="radio" name="q${p.id}" value="false"> False
      </label>`;
    }

    /* üî• NUEVA ESTRUCTURA DE CALCULATION */
    if (p.tipo === "calculation") {
      html += `
      <div class="calc-wrapper">
        <input
          type="number"
          name="q${p.id}"
          class="calc-value"
          placeholder="Value"
          required
        >
        <input
          type="text"
          class="calc-unit"
          placeholder="Units"
        >
      </div>`;
    }

    html += "</div>";
    container.insertAdjacentHTML("beforeend", html);
  });
});

/* ========= SUBMIT ========= */
form.addEventListener("submit", async e => {
  e.preventDefault();

  const data = new FormData(form);
  const payload = {
    nombre: data.get("nombre"),
    email: data.get("email"),
    testId: data.get("testId"),
    answers: []
  };

  for (const [k, v] of data.entries()) {
    if (k.startsWith("q") && v !== "") {
      payload.answers.push({
        questionId: k.substring(1),
        answer: isNaN(v) ? v : Number(v)
      });
    }
  }

  try {
    await fetch(SUBMIT_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    resultadoDiv.innerText = "‚úÖ Exam submitted successfully";
  } catch {
    resultadoDiv.innerText = "‚ùå Error submitting exam";
  }
});
</script>

</body>
</html>

