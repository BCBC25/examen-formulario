¬¥¬¥
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>University Examination Portal</title>

<style>
body {
  margin: 0;
  font-family: "Segoe UI", Roboto, Arial, sans-serif;
  background: linear-gradient(135deg, #eef2f7, #dbeafe);
}
.container {
  max-width: 900px;
  margin: auto;
  padding: 40px 20px;
  position: relative;
}
.card {
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.12);
  padding: 35px;
}
.hidden { display: none; }
.question { margin-bottom: 26px; }
.option-row { display: flex; gap: 8px; margin: 6px 0; }
.calc-wrapper { display: flex; gap: 12px; margin-top: 6px; }
.calc-value { flex: 2; }
.calc-unit { flex: 1; }
.submit-btn { width: 100%; margin-top: 25px; font-size: 16px; }
</style>
</head>

<body>

<div class="container hidden" id="examScreen">
<div class="card">
<h1>DRILLING TEST</h1>

<form id="examForm">
<label>Name</label>
<input type="text" name="nombre" required>

<label>Email</label>
<input type="email" name="email" required>

<input type="hidden" name="testId" value="1">

<div id="preguntas">Loading questions...</div>

<button type="submit" class="submit-btn">Submit Exam</button>
</form>

<div id="resultado"></div>
</div>
</div>

<script>
/* ========= CONFIG ========= */
const SUBMIT_URL = "https://gilloli.app.n8n.cloud/webhook-test/student-exam-submission-v2";
const questionsUrl = "https://script.google.com/macros/s/AKfycbwOJdDrp_XNfIQPv6mph0IhzI7W9JGZFhqErWC5YJE-UfkETADJNkB0IfYJCiEp4_pxcg/exec";

const form = document.getElementById("examForm");
const resultadoDiv = document.getElementById("resultado");

/* ========= LOAD QUESTIONS ========= */
fetch(questionsUrl)
.then(res => res.json())
.then(preguntas => {
  const container = document.getElementById("preguntas");
  container.innerHTML = "";

  preguntas.forEach(p => {
    let html = `<div class="question"><strong>${p.id}. ${p.pregunta}</strong>`;

    if (p.tipo === "multiple option") {
      ["A","B","C","D"].forEach(o => {
        html += `
        <label class="option-row">
          <input type="radio" name="q${p.id}" value="${o}"> ${o}) ${p["opcion"+o]}
        </label>`;
      });
    }

    if (p.tipo === "true/false") {
      html += `
        <label class="option-row"><input type="radio" name="q${p.id}" value="true"> True</label>
        <label class="option-row"><input type="radio" name="q${p.id}" value="false"> False</label>`;
    }

    if (p.tipo === "open-ended") {
      html += `<textarea name="q${p.id}"></textarea>`;
    }

    /* üî• FIX C√ÅLCULOS */
    if (p.tipo === "calculation") {
      html += `
      <div class="calc-wrapper" data-calc-id="${p.id}">
        <input type="number" class="calc-value" placeholder="Value">
        <input type="text" class="calc-unit" placeholder="Units">
        <input type="hidden" name="q${p.id}">
      </div>`;
    }

    html += "</div>";
    container.insertAdjacentHTML("beforeend", html);
  });

  document.getElementById("examScreen").classList.remove("hidden");
});

/* ========= SUBMIT ========= */
form.addEventListener("submit", async e => {
e.preventDefault();

/* üî• FORZAR C√ÅLCULOS */
document.querySelectorAll(".calc-wrapper").forEach(w => {
  const id = w.dataset.calcId;
  const value = w.querySelector(".calc-value").value || "";
  const unit = w.querySelector(".calc-unit").value || "";
  w.querySelector(`input[name="q${id}"]`).value =
    `${value} ${unit}`.trim();
});

const data = new FormData(form);

const payload = {
  nombre: data.get("nombre"),
  email: data.get("email"),
  testId: data.get("testId"),
  answers: []
};

for (const [k, v] of data.entries()) {
  if (k.startsWith("q")) {
    payload.answers.push({
      questionId: k.substring(1),
      answer: v || ""
    });
  }
}

try {
  await fetch(SUBMIT_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });

  resultadoDiv.innerText = "Exam submitted successfully.";
  resultadoDiv.style.color = "green";

} catch {
  resultadoDiv.innerText = "Error submitting exam.";
  resultadoDiv.style.color = "red";
}
});
</script>

</body>
</html>
