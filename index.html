<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Prueba para alumnos</title>
</head>
<body>
  <h1>Prueba</h1>

  <form id="examForm">
    <label>Nombre:<br>
      <input type="text" name="nombre" required />
    </label><br /><br />

    <label>Email:<br>
      <input type="email" name="email" required />
    </label><br /><br />

    <input type="hidden" name="testId" value="1" />

    <div id="preguntas">Cargando preguntas...</div>

    <button type="submit">Enviar examen</button>
  </form>

  <div id="resultado"></div>

  <script>
    const questionsUrl = "https://script.google.com/macros/s/AKfycbwOJdDrp_XNfIQPv6mph0IhzI7W9JGZFhqErWC5YJE-UfkETADJNkB0IfYJCiEp4_pxcg/exec";
    const form = document.getElementById('examForm');
    const resultadoDiv = document.getElementById('resultado');

    // Cargar preguntas y mostrarlas
    fetch(questionsUrl)
      .then(res => res.json())
      .then(preguntas => {
        const container = document.getElementById("preguntas");
        container.innerHTML = "";

        preguntas.forEach(p => {
          const tipo = (p.tipo || "").toLowerCase();
          const div = document.createElement("div");
          let html = `<p>${p.id}. ${p.pregunta}</p>`;

          if (tipo === "multiple option") {
            html += `
              <label><input type="radio" name="q${p.id}" value="A" required> A) ${p.opcionA}</label><br>
              <label><input type="radio" name="q${p.id}" value="B"> B) ${p.opcionB}</label><br>
              <label><input type="radio" name="q${p.id}" value="C"> C) ${p.opcionC}</label><br>
              <label><input type="radio" name="q${p.id}" value="D"> D) ${p.opcionD}</label><br>
            `;
          } else if (tipo === "open-ended") {
            html += `<textarea name="q${p.id}" rows="4" cols="60" required></textarea>`;
          } else if (tipo === "true/false") {
            html += `
              <label><input type="radio" name="q${p.id}" value="true" required> Verdadero</label><br>
              <label><input type="radio" name="q${p.id}" value="false"> Falso</label><br>
            `;
          } else if (tipo === "calculation") {
            html += `<input type="number" name="q${p.id}" step="any" required>`;
          } else {
            html += `<input type="text" name="q${p.id}" required>`;
          }

          div.innerHTML = html;
          container.appendChild(div);
          container.appendChild(document.createElement("br"));
        });
      })
      .catch(err => {
        document.getElementById("preguntas").innerText = "Error al cargar preguntas.";
        console.error(err);
      });

    // Capturar el envÃ­o del formulario
    form.addEventListener('submit', async (event) => {
      event.preventDefault();

      // Construir objeto con todos los datos del formulario
      const formData = new FormData(form);
      const data = {};
      formData.forEach((value, key) => {
        data[key] = value;
      });

      try {
        const response = await fetch('https://gilloli.app.n8n.cloud/webhook/student-exam-submission', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });

        if (response.ok) {
          resultadoDiv.innerText = "Examen enviado correctamente.";
          form.reset();
        } else {
          resultadoDiv.innerText = "Error al enviar el examen.";
          console.error("Error en la respuesta del webhook:", response.statusText);
        }
      } catch (error) {
        resultadoDiv.innerText = "Error al enviar el examen.";
        console.error("Error al enviar el formulario:", error);
      }
    });
  </script>
</body>
</html>
